# 标准库

Go 标准库是一组核心包，用来扩展和增加语言的能力。这些包为语言增加了大量不同的类型。开发人员可以直接使用这些类型，而不用再写自己的包或者去下载
其他人发布的第三方包。由于这些包和语言绑在一起发布，它们会得到以下特殊的保证：

*   每次语言更新，哪怕是小更新，都会带有标准库；

*   这些标准库会严格向后兼容的承诺；

*   标准库是 Go 语言开发、构建、发布过程的一部分；

*   标准库由 Go 的构建者们维护和评审；

*   每次 Go 语言发布新版本时，标准库都会被测试，并评估性能；

这些保证让标准库变得很特殊，应尽量利用这些标准库。使用标准库里的包可以使管理代码变得更容易，并且保证代码的稳定。不用担心程序无法兼容不同的 Go
语言版本，也不用管理第三方依赖。

## 文档与源代码

标准库里总共有超过 100 个包，这些包被分到 38 个类别里，如下：`archive`、`bufio`、`bytes`、`compress`、`container`、`cryto`、
`database`、`debug`、`encoding`、`errors`、`expvar`、`flag`、`fmt`、`go`、`hash`、`html`、`image`、`index`、`io`、`log`、
`math`、`mime`、`net`、`os`、`path`、`reflect`、`regexp`、`runtime`、`sort`、`strconv`、`strings`、`sync`、`syscall`、`testing`、
`text`、`time`、`unicode`、`unsafe`。

以上许多分类本身就是一个包。

不管用什么方式安装 Go，标准库的源代码都会安装在`$GOROOT/src/pkg`（注：这里应该错了吧，是`$GOROOT/src`才对）文件夹里。拥有标准库的源代码对
Go 工具正常工作非常重要。类似 godoc、gocode 甚至 go build 这些工具，都需要读取标准库的源代码才能完成其工作。如果源代码没有安装在以上文件夹
中，或者无法通过 $GOROOT 变量访问，在试图编译程序时会产生错误。

作为 Go 发布包的一部分，标准库的源代码是经过预编译的。这些预编译后的文件，称作**归档文件(archive file)**，可以在`$GOROOT/pkg`文件中找到
已经安装的各目标平台和操作系统的归档文件，也就是扩展名为`.a`的文件。这些文件是特殊的 Go 静态库文件，由 Go 的构建工具创建，并在编译和链接最终
程序时被使用。归档文件可以让构建的速度更快。但是在构建的过程中，没办法指定这些文件，所以没办法与别人共享这些文件。Go 工具链知道什么时候可以使用
已有的`.a`文件，什么时候需要从机器上的源代码重新构建。

下面来看一下标准库里的几个包，看看如何用这些包来构建自己的程序。

## 记录日志

即使没有表现出来，程序依旧可能有 bug。这在软件开发里是很自然的事情。日志是一种找到这些 bug，更好地了解程序工作状态的方法。日志是开发人员的眼睛
和耳朵，可以用来跟踪、调试和分析代码。基于此，标准库提供了 log 包，可以对日志做一些最基本的配置。根据特殊需要，还可以自己定制日志记录器。

在 UNIX 里，日志有很长的历史。传统的 CLI 程序直接将输出写到名为 stdout 的设备上。所有的操作系统上都有这种设备，这种设备的默认目的地是标准文
本输出。默认设置下，终端会显示这些写到 stdout 设备上的文本。然而这种单个目的地的输出，总会碰到需要同时输出程序信息和输出执行细节的情况。这些执
行细节被称作日志。当想要记录日志时，希望能写到不同的目的地，这样就不会将程序的输出和日志混在一起了。

为了解决这个问题，UNIX 架构上增加了一个叫作 stderr 的设备。这个设备被创建为日志的默认目的地。这个就能将程序的输出和日志分离开来。如果想在程序
运行时同时看到程序输出和日志，可以将终端配置为同时显示写到 stdout 和 stderr 的信息。不过，如果用户的程序只记录日志，没有程序输出，更常用的方
式是将一般的日志信息写到 stdout，将错误或者警告信息写到 stderr。

### log 包

记录日志的目的是跟踪程序什么时候在什么位置做了什么。这就需要通过某些配置在每个日志项上要写的一些信息，如以下代码清单：

```
TRACE: 2018/01/01 11:11:11.000000 /tmpfs/gosandbox-/prog.go:14: message
```

可以看到一个由 log 包产生的日志项。这个日志项包含前缀、日期时间戳、该日志具体是由哪个源文件记录的、源文件记录日志所在行，最后
是日志消息。看一下如何配置 log 包来输出这样的日志项，[listing03.go](listing03.go)

### 定制的日志记录器

要想创建一个定制的日志记录器，需要创建一个 Logger 类型值。可以给每个日志记录器配置一个单独的目的地，并独立设置其前缀和标志，
[listing11.go](listing11.go)

